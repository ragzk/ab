var APP=angular.module("APP",["matchmedia-ng","ngProgress","ngSanitize"]);$(document).ready(function(){$(".slider3").bxSlider({slideWidth:5e3,minSlides:2,maxSlides:4,slideMargin:10})}),APP.controller("agentController",["$http",function(e){this.agents=[],this.init=function(t){that=this,this.agentId=t.agentId,e.get("/agentDetails/"+this.agentId,{params:{agentId:this.agentId}}).then(function(e){that.agent=e.data})},this.initNew=function(){that=this,e.get("/agents/getAgents").then(function(e){that.agents=e.data})}}]),APP.controller("buyController",["$http",function(e){this.properties=[],this.init=function(t){this.type=t.type,this.getPropertiesUrl=t.getPropertiesUrl,that=this,e.get(this.getPropertiesUrl,{params:{type:this.type}}).then(function(e){that.properties=e.data})}}]),APP.controller("mainController",["$scope","ngProgressFactory",function(e,t){e.progressbar=t.createInstance();var r=e.$bus().channel("ngProgressChannel");r.subscribe("ngProgressChannelStart",function(t){e.progressbar.start()}),r.subscribe("ngProgressChannelComplete",function(t){e.progressbar.complete()}),r.publish("ngProgressChannelStart"),r.publish("ngProgressChannelComplete")}]),APP.controller("propertyController",["$http",function(e){this.property={},this.init=function(t){this.uniqueId=t.uniqueId,that=this,e.get("/property/getProperty/"+this.uniqueId,{params:{uniqueId:this.uniqueId}}).then(function(e){that.property=e.data})}}]),APP.controller("searchController",["$scope","matchmedia",function(e,t){e.matchMedia=t,e.isDesktop=t.isDesktop(),e.search={},e.search.types=["Buy","Rent","Sold"],e.search.propertyTypes=["Any property type","House","Apartment","Commercial"],e.search.selectedType=0;t.onPhone(function(t){e.isDesktop=!t.matches})}]),APP.controller("sidebarController",["$scope","ngProgressFactory","$location","$window",function(e,t,r,s){e.progressbar=t.createInstance();var n=e.$bus().channel("ngProgressChannel");n.subscribe("ngProgressChannelStart",function(t){e.progressbar.start()}),n.subscribe("ngProgressChannelComplete",function(t){e.progressbar.complete()}),e.toggle=!1,e.buy=function(){s.location.href="/buy"};var i=r.absUrl().split(/[\s/]+/).pop();i?_.each($(".title.parent"),function(e){$(e).find("a").attr("href")=="/"+i||$(e).find("div:first").slideToggle("slow")}):$(".list-group-item.child").slideToggle("fast"),$("#buy").click(function(e){var t=$(e.target);t.is("span")&&(e.stopPropagation(),e.preventDefault())}),e.toggleMenu=function(t){e.toggle=!e.toggle,$(t.target.parentElement).find("div").slideToggle("slow"),$("#content").load($(this).find("a").attr("href"))},$(".title a a").click(function(){return $("#content").load($(this).attr("href")),!0}),n.publish("ngProgressChannelStart"),n.publish("ngProgressChannelComplete")}]),APP.directive("agentDetails",function(){return{replace:!1,transclude:!0,scope:{agent:"="},templateUrl:"/public/templates/agentDetails.html",link:function(e,t,r){}}}),APP.directive("agentDetailsSummary",function(){return{replace:!1,transclude:!0,scope:{agent:"="},templateUrl:"/public/templates/agentDetailsSummary.html",link:function(e,t,r){}}}),APP.directive("bxSlider",["$http","$compile","$timeout",function(e,t,r){return{scope:{},template:'<div class="bxslider1"><div class="slide" ng-repeat="image in images track by $index"><img class="sliderimg" ng-src="{{image.imageUrl}}" alt="" /><div class="bxslider-property-details"><div class="bxslider-property-features"><span ng-show="image.propertyFeature.bedroom">{{ image.propertyFeature.bedroom }}<span class="fa fa-bed spacing-icon"></span></span><span class="extra-spacing-icon" ng-show="image.propertyFeature.bathroom">{{ image.propertyFeature.bathroom }}<img class="bath-icon spacing-icon" src="/public/images/icons/bath.png" /></span><span class="extra-spacing-icon" ng-show="image.propertyFeature.garages">{{image.propertyFeature.garages}}<span class="fa fa-car spacing-icon"></span></span></div><div><span>{{image.propertyAddressAsText}}</span></div></div></div>',link:function(t,s,n){var i=function(e){t.images=e.data||e,t.showdetails&&_.each(t.images,function(e){e.propertyFeature=_.head(e.propertyfeatures),e.propertyAddress=_.head(e.propertyaddresses),e.propertyAddress&&(e.propertyAddressAsText=e.propertyAddress.suburb+", "+e.propertyAddress.streetNumber+" "+e.propertyAddress.street)});var n=s;r(function(){$(n.children(".bxslider1")).bxSlider({slideWidth:5e3,minSlides:1,maxSlides:1,auto:!0,pager:!1,slideMargin:10})},0,!1)};t.showdetails=n.showdetails,n.url&&e.get(n.url).then(i),n.data&&i(JSON.parse(n.data))}}}]),APP.directive("propertyDetails",function(){return{replace:!1,transclude:!0,scope:{property:"="},templateUrl:"/public/templates/propertyDetails.html",link:function(e,t,r){e.$watch("property",function(){if(e.property.uniqueId){e.transaction=e.property.rent?"Rent":"Sale",e.transactionPrice=e.property.rent?e.property.rent:e.property.priceValue,e.propertyAddress=_.head(e.property.propertyaddresses),e.propertyFeature=_.head(e.property.propertyfeatures);var t=_.head(e.property.propertydescriptions);t&&t.propertydescription&&(e.propertyDescription=t.propertydescription,e.propertyDescription=e.propertyDescription.replace(/\r\n\r\n/g,"</p><p>").replace(/\n\n/g,"</p><p>"),e.propertyDescription=e.propertyDescription.replace(/\r\n/g,"<br />").replace(/\n/g,"<br />")),e.propertyAddress&&(e.propertyAddressAsText=e.propertyAddress.streetNumber+" "+e.propertyAddress.street+", "+e.propertyAddress.suburb)}})}}}),APP.directive("shortPropertyDetails",function(){return{replace:!1,transclude:!0,scope:{property:"=property"},templateUrl:"/public/templates/shortPropertyDetails.html",link:function(e,t,r){e.propertyAddress=_.head(e.property.propertyaddresses),e.propertyFeature=_.head(e.property.propertyfeatures);var s=_.head(e.property.propertydescriptions);if(s&&s.propertydescription&&(e.propertyDescription=s.propertydescription),e.propertyAddress&&(e.propertyAddressAsText=e.propertyAddress.streetNumber+" "+e.propertyAddress.street+", "+e.propertyAddress.suburb),e.property.inspectionTimes){var n=_.last(e.property.inspectionTimes.split(","));n&&_.first(n.split(" to"))&&moment(Date(_.first(n.split(" to")))).isAfter(Date.now())?e.property.inspectionTimes=n:e.property.inspectionTimes=null}}}}),APP.directive("showSelected",["$timeout",function(e){return{link:function(t,r,s){e(function(){var e=$(r.find("li a")[0]).text();r.parents(".btn-group").find(".dropdown-toggle").html(e+'<span class="caret"></span>'),r.find("li a").on("click",function(){var e=$(this).text();$(this).parents(".btn-group").find(".dropdown-toggle").html(e+'<span class="caret"></span>')})})}}}]),APP.directive("select2",["$timeout",function(e){return{link:function(e,t,r){t.select2({minimumResultsForSearch:-1})}}}]),APP.config(["$provide",function(e){e.decorator("$rootScope",["$delegate",function(e){return e.constructor.prototype.$bus=function(){var e=this,t=$.extend({},postal,{subscribe:function(){var t=postal.subscribe.apply(postal,arguments);return e.$on("$destroy",function(){t.unsubscribe()}),t}});return t},e}])}]),APP.filter("cut",function(){return function(e,t,r,s){if(!e)return"";if(r=parseInt(r,10),!r)return e;if(e.length<=r)return e;if(e=e.substr(0,r),t){var n=e.lastIndexOf(" ");-1!=n&&("."!=e.charAt(n-1)&&","!=e.charAt(n-1)||(n-=1),e=e.substr(0,n))}return e+(s||" â€¦")}});